<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <script src="codemirror/lib/codemirror.js"></script>
    <link rel="stylesheet" href="codemirror/lib/codemirror.css">
    <script src="codemirror/mode/javascript/javascript.js"></script>
    <script type="text/javascript" src="https://www.google.com/jsapi?autoload={'modules':[{'name':'visualization',
       'version':'1','packages':['timeline']}]}"></script>
    <script src="js/tss/job.js"></script>

</head>
<body>

    <textarea id="editor" width="100%">
        var i;

        for (i = 0; i < jobs.length; ++i) {
            launchJobOnNode(nodes[i%nodes.length], jobs[i], i*10);
        }
    </textarea>
    <script>
        "use strict";
        var codeMirror = CodeMirror.fromTextArea(document.querySelector('#editor'), {
            lineNumbers: true,
            mode: "javascript"
        });
    </script>
    <label for="jobs">Jobs nr:</label><input id="jobs" type="number" value="100"/>
    <label for="nodes">Nodes:</label><input id="nodes" type="number" value="4"/>
    <button id="generate">Generate Jobs</button>
    <button id="run">Run</button>
    <div id="graph" style="width: 100%; height: 200px;">
    </div>

    <script>
        function drawChart(jobs) {
            var dataTable = new google.visualization.DataTable();
            var chart = new google.visualization.Timeline(document.getElementById('graph'));
            dataTable.addColumn({ type: 'string', id: 'Position' });
            dataTable.addColumn({ type: 'string', id: 'Name' });
            dataTable.addColumn({ type: 'number', id: 'Start' });
            dataTable.addColumn({ type: 'number', id: 'End' });
            var i;
            for (i = 0; i < jobs.length; ++i) {
                dataTable.addRow(jobs[i].vizRow());
            }
            chart.draw(dataTable, {
                colorByRowLabel: true
            });
        }
    </script>
    <script>
        var tss;
        function generate() {
            tss = new TSS(parseInt(document.getElementById('nodes').value));
            tss.setCode(codeMirror.getValue());
            tss.generateRandomJobs(parseInt(document.getElementById('jobs').value));
        }
        document.getElementById('generate').addEventListener('click', generate);
        document.getElementById('run').addEventListener('click', function() {
            if (tss === undefined) {
                generate();
            }
            tss.reset();
            tss.run();
            drawChart(tss.jobs, {
                forceIFrame: true,
                width: 2000
            });
        });


    </script>
</body>
</html>